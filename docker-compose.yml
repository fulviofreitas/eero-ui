services:
  eero-ui:
    build: .
    container_name: eero-ui
    ports:
      - "8000:8000"
    volumes:
      # Persist session data and metrics across container restarts
      - eero-data:/data
    environment:
      EERO_DASHBOARD_HOST: "0.0.0.0"
      EERO_DASHBOARD_PORT: "8000"
      EERO_DASHBOARD_DEBUG: "false"
      # REQUIRED: Generate a secure secret with: openssl rand -hex 32
      # Set in .env file or export before running docker-compose
      EERO_DASHBOARD_SESSION_SECRET: "${EERO_DASHBOARD_SESSION_SECRET:?Session secret required - run openssl rand -hex 32}"
      # Metrics collection configuration
      EERO_DASHBOARD_COLLECTION_INTERVAL: "${EERO_DASHBOARD_COLLECTION_INTERVAL:-60}"
      EERO_DASHBOARD_METRICS_RETENTION: "${EERO_DASHBOARD_METRICS_RETENTION:-1y}"
      # Optional: Expose /metrics endpoint for external Prometheus scraping
      EERO_DASHBOARD_METRICS_ENDPOINT_ENABLED: "${EERO_DASHBOARD_METRICS_ENDPOINT_ENABLED:-false}"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

volumes:
  eero-data:
