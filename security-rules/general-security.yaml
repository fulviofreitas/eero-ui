# ============================================================================
# üîê General Security Rules for Opengrep
# ============================================================================
# These rules detect common security issues that apply across multiple
# languages and file types in the codebase.
#
# Note: Rules are tuned to reduce false positives for this project.
# ============================================================================

rules:
  # --------------------------------------------------------------------------
  # Secrets & Credentials Detection
  # --------------------------------------------------------------------------
  - id: generic-private-key
    languages:
      - generic
    message: |
      Private key detected in source code. Never commit private keys.
      Use a secrets manager or environment variables.
    severity: ERROR
    pattern-regex: '-----BEGIN (?:RSA |EC |DSA |OPENSSH )?PRIVATE KEY-----'
    paths:
      exclude:
        - "**/test*"
        - "**/*.test.*"
        - "**/mock*"
        - "**/*.md"
    metadata:
      category: security
      subcategory: secrets
      cwe: CWE-798

  - id: generic-aws-access-key
    languages:
      - generic
    message: |
      Potential AWS Access Key detected. Remove and rotate immediately.
    severity: ERROR
    pattern-regex: '(?:A3T[A-Z0-9]|AKIA|AGPA|AIDA|AROA|AIPA|ANPA|ANVA|ASIA)[A-Z0-9]{16}'
    paths:
      exclude:
        - "**/*.md"
        - "**/security-rules/**"
    metadata:
      category: security
      subcategory: secrets
      cwe: CWE-798
      cloud: aws

  - id: generic-github-token
    languages:
      - generic
    message: |
      GitHub token detected. Remove and rotate immediately.
    severity: ERROR
    pattern-regex: 'gh[pousr]_[A-Za-z0-9_]{36,}'
    paths:
      exclude:
        - "**/*.md"
        - "**/security-rules/**"
    metadata:
      category: security
      subcategory: secrets
      cwe: CWE-798

  - id: generic-slack-webhook
    languages:
      - generic
    message: |
      Slack webhook URL detected. Use environment variables instead.
    severity: ERROR
    pattern-regex: 'https://hooks\.slack\.com/services/T[A-Z0-9]+/B[A-Z0-9]+/[a-zA-Z0-9]+'
    metadata:
      category: security
      subcategory: secrets
      cwe: CWE-798

  - id: generic-stripe-key
    languages:
      - generic
    message: |
      Stripe API key detected. Use environment variables instead.
    severity: ERROR
    pattern-regex: '(?:sk|pk)_(?:live|test)_[A-Za-z0-9]{24,}'
    metadata:
      category: security
      subcategory: secrets
      cwe: CWE-798

  # --------------------------------------------------------------------------
  # Debug & Development Code
  # --------------------------------------------------------------------------
  - id: generic-todo-security
    languages:
      - generic
    message: |
      Security-related TODO found. Address before deployment.
    severity: INFO
    pattern-regex: '(?i)(?:TODO|FIXME|XXX).*(?:security|vulnerable|insecure|auth.?bypass)'
    paths:
      exclude:
        - "**/security-rules/**"
        - "**/*.md"
    metadata:
      category: security
      subcategory: code-review

  # --------------------------------------------------------------------------
  # Docker Security
  # --------------------------------------------------------------------------
  - id: dockerfile-latest-tag
    languages:
      - dockerfile
    message: |
      Using :latest tag is not recommended. Pin to a specific version.
    severity: INFO
    pattern-regex: 'FROM\s+[a-zA-Z0-9._/-]+:latest'
    metadata:
      category: security
      subcategory: container
      cwe: CWE-1104
