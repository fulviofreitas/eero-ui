# ============================================================================
# ğŸ“ Commit Message Linting
# ============================================================================
# Validates commit messages follow Conventional Commits specification.
# This enables automatic changelog generation and semantic versioning.
# ============================================================================

name: ğŸ“ Commit Lint

on:
  pull_request:
    branches: [main, master, develop]
  push:
    branches: [main, master, develop]

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

permissions:
  contents: read
  pull-requests: read

jobs:
  # ============================================================================
  # ğŸ“ Validate Commit Messages
  # ============================================================================
  commitlint:
    name: ğŸ“ Validate Commits
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ“¦ Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: ğŸ”§ Install commitlint
        run: |
          npm install -g @commitlint/cli @commitlint/config-conventional

      - name: ğŸ” Validate PR commits
        if: github.event_name == 'pull_request'
        run: |
          npx commitlint \
            --from ${{ github.event.pull_request.base.sha }} \
            --to ${{ github.event.pull_request.head.sha }} \
            --verbose

      - name: ğŸ” Validate push commits
        if: github.event_name == 'push'
        run: |
          # Validate the last commit on push (for direct pushes to main branches)
          npx commitlint --last --verbose

      - name: ğŸ“ Generate validation summary
        if: always()
        run: |
          cat >> $GITHUB_STEP_SUMMARY << 'EOF'
          ## ğŸ“ Commit Message Validation

          > [!TIP]
          > Use [Conventional Commits](https://conventionalcommits.org) for automatic versioning!

          ### ğŸ“‹ Expected Format

          ```
          <type>(<scope>): <subject>

          [optional body]

          [optional footer(s)]
          ```

          ### ğŸ·ï¸ Commit Types

          | Type | Description | Version Bump |
          |:-----|:------------|:-------------|
          | âœ¨ `feat` | New feature | **Minor** |
          | ğŸ› `fix` | Bug fix | **Patch** |
          | âš¡ `perf` | Performance improvement | Patch |
          | â™»ï¸ `refactor` | Code refactoring | Patch |
          | ğŸ“š `docs` | Documentation | None |
          | ğŸ’„ `style` | Code style (formatting) | None |
          | ğŸ§ª `test` | Tests | None |
          | ğŸ”§ `chore` | Maintenance | None |
          | ğŸ‘· `ci` | CI/CD changes | None |

          ### ğŸ’¥ Breaking Changes

          Add `BREAKING CHANGE:` in the footer or `!` after type for a **major** version bump.

          ```
          feat!: remove deprecated API endpoint
          ```

          EOF
